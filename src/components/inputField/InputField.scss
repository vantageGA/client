@use '../../index.scss' as *;

// Input field color tokens for dark aesthetic
$input-bg-default: rgba(25, 25, 25, 1);
$input-bg-hover: rgba(35, 35, 35, 1);
$input-bg-focus: rgba(45, 45, 45, 1);
$input-bg-fieldset: rgba(30, 30, 30, 1); // Slightly lighter for fieldset context
$input-border-default: rgba(75, 75, 75, 1);
$input-border-hover: rgba(100, 100, 100, 1);
$input-border-focus: $burnt-orange;
$input-text-default: $main-font-colour;
$input-text-focus: $main-font-colour;
$input-placeholder: rgba(190, 190, 190, 1); // WCAG AA compliant contrast (4.5:1)
$input-valid-color: $success;
$input-invalid-color: $danger;

.input-field-wrapper {
  margin-bottom: 0.4rem;
  margin-top: 0.4rem;

  // Label styling - sophisticated uppercase treatment
  label {
    display: block;
    font-family: 'Comfortaa', cursive;
    font-size: 0.95rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: $input-text-default;
    margin-bottom: 0.5rem;
    line-height: 1.4;

    // Required asterisk styling
    span[aria-label='required'] {
      color: $burnt-orange;
      margin-left: 0.25em;
    }
  }

  // Base input styling for all text input types
  input[type='text'],
  input[type='email'],
  input[type='password'],
  input[type='search'],
  input[type='tel'],
  textarea {
    width: 100%;
    padding: 0.75rem 1rem;
    margin: 0;
    box-sizing: border-box;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;

    // Typography
    font-family: 'Comfortaa', cursive;
    font-size: 1rem;
    color: $input-text-default;
    line-height: 1.5;

    // Dark aesthetic styling
    background-color: $input-bg-default;
    border: 1px solid $input-border-default;
    border-radius: 4px;

    // Subtle depth with inset shadow
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
    -webkit-box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);

    // Smooth transitions
    transition: background-color 150ms ease, border-color 150ms ease,
      box-shadow 150ms ease, transform 150ms ease;

    // Placeholder styling
    &::placeholder {
      color: $input-placeholder;
      font-style: italic;
      opacity: 1;
    }

    // Hover state
    &:hover:not(:focus) {
      background-color: $input-bg-hover;
      border-color: $input-border-hover;
    }

    // Focus state with burnt-orange accent
    &:focus {
      background-color: $input-bg-focus;
      border-color: $input-border-focus;
      border-left: 3px solid $input-border-focus;
      outline: 2px solid rgba($burnt-orange, 0.3);
      outline-offset: 2px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3),
        0 0 0 3px rgba($burnt-orange, 0.1);
    }

    // Ensure touch targets are at least 48px
    min-height: 48px;
  }

  // Override browser autocomplete styling
  input:-webkit-autofill,
  input:-webkit-autofill:hover,
  input:-webkit-autofill:focus,
  input:-webkit-autofill:active {
    -webkit-box-shadow: 0 0 0 30px rgba(25, 25, 25, 1) inset !important;
    -webkit-text-fill-color: $main-font-colour !important;
    caret-color: $main-font-colour !important;
    transition: background-color 5000s ease-in-out 0s;
  }

  // For Firefox
  input:-moz-autofill,
  input:-moz-autofill:hover,
  input:-moz-autofill:focus {
    box-shadow: 0 0 0 30px rgba(25, 25, 25, 1) inset !important;
    -moz-text-fill-color: $main-font-colour !important;
  }

  // Within fieldsets, use slightly lighter background for better contrast
  fieldset & {
    input[type='text'],
    input[type='email'],
    input[type='password'],
    input[type='search'],
    input[type='tel'],
    textarea {
      background-color: $input-bg-fieldset;

      &:hover:not(:focus) {
        background-color: rgba(40, 40, 40, 1);
      }
    }
  }

  // Valid/Entered state - subtle green bottom border
  input[type='text'].entered,
  input[type='email'].entered,
  input[type='password'].entered,
  input[type='search'].entered,
  input[type='tel'].entered,
  textarea.entered {
    border-bottom: 2px solid $input-valid-color;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2),
      0 2px 4px rgba($input-valid-color, 0.2);

    &:focus {
      border-left: 3px solid $input-border-focus;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3),
        0 0 0 3px rgba($burnt-orange, 0.1),
        0 2px 4px rgba($input-valid-color, 0.3);
    }
  }

  // Invalid state - red border with 3px left accent
  input[type='text'].invalid,
  input[type='email'].invalid,
  input[type='password'].invalid,
  input[type='search'].invalid,
  input[type='tel'].invalid,
  textarea.invalid {
    border: 1px solid $input-invalid-color;
    border-left: 3px solid $input-invalid-color;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2),
      0 0 8px rgba($input-invalid-color, 0.3);

    &:focus {
      outline: 2px solid rgba($input-invalid-color, 0.3);
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.3),
        0 0 0 3px rgba($input-invalid-color, 0.15),
        0 0 8px rgba($input-invalid-color, 0.4);
    }
  }

  // Search input - centered placeholder
  input[type='search']::placeholder {
    text-align: center;
  }

  // Label and icon wrapper (for password toggle)
  .input-icon-wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;

    // Password toggle icon
    div {
      font-size: 1.4em;
      cursor: pointer;
      padding: 6px;
      color: $warning;
      transition: color 150ms ease, transform 150ms ease;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;

      // Hover state - light orange
      &:hover {
        color: $light-orange;
        transform: scale(1.1);
      }

      // Focus state for keyboard navigation
      &:focus {
        outline: 2px solid $burnt-orange;
        outline-offset: 2px;
        color: $light-orange;
      }

      // Active state
      &:active {
        transform: scale(0.95);
      }
    }

    // Icon specific styling
    .icon-colour {
      color: inherit;
    }
  }

  // Field hint text (validation requirements, etc.) - WCAG AA compliant contrast
  .field-hint {
    display: block;
    font-size: 0.85em;
    color: rgba(245, 190, 110, 1); // Lighter than $warning for 4.5:1+ contrast
    margin-top: 0.5rem;
    line-height: 1.4;
  }

  // Validation error message with animation
  .validation-error {
    display: block;
    color: $input-invalid-color;
    background-color: rgba($input-invalid-color, 0.1);
    padding: 0.5rem 0.75rem;
    margin-top: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    border-left: 3px solid $input-invalid-color;
    border-radius: 2px;
    animation: slideIn 200ms ease-out;

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  }

  // Responsive adjustments
  @media (max-width: 812px) {
    input[type='text'],
    input[type='email'],
    input[type='password'],
    input[type='search'],
    input[type='tel'],
    textarea {
      padding: 0.875rem 1rem;
    }
  }

  @media (max-width: 480px) {
    input[type='text'],
    input[type='email'],
    input[type='password'],
    input[type='search'],
    input[type='tel'],
    textarea {
      padding: 1rem;
      font-size: 1rem; // Prevents iOS zoom on focus
    }

    label {
      font-size: 0.9rem;
    }
  }
}

// Accessibility: Respect reduced motion preference
@media (prefers-reduced-motion: reduce) {
  .input-field-wrapper {
    input[type='text'],
    input[type='email'],
    input[type='password'],
    input[type='search'],
    input[type='tel'],
    textarea,
    .input-icon-wrapper div {
      transition: none;
    }

    .validation-error {
      animation: none;
    }
  }
}
